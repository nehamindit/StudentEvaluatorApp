<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Answer Evaluator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f8;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    textarea, input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      margin-bottom: 20px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .results {
      white-space: pre-wrap;
      background-color: #f0f0f0;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
    #exportBtn {
      background-color: #007BFF;
      margin-top: -10px;
    }
    #exportBtn:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß† Student Answer Evaluator (POC)</h1>

    <label for="model">ü§ñ Choose Model</label>
    <select id="model">
      <option value="mistralai/Mistral-7B-Instruct-v0.2">Mistral 7B Instruct</option>
      <option value="tiiuae/falcon-7b-instruct">Falcon 7B Instruct</option>
      <option value="google/flan-t5-large">FLAN-T5 Large</option>
    </select>

    <label for="question">‚ùì Question</label>
    <textarea id="question">Explain the importance of photosynthesis in plants.</textarea>

    <label for="rubric">üìã Rubric (one point per line)</label>
    <textarea id="rubric">Mentions that photosynthesis is how plants make food.
Explains the role of sunlight, carbon dioxide, and water.
Describes oxygen release.
Includes importance to the ecosystem.</textarea>

    <label for="answers">üë®‚Äçüéì Student Answers (format: Name: Answer)</label>
    <textarea id="answers">Alice: Photosynthesis helps plants make food using sunlight.
Bob: Plants use sunlight and water to make food and release oxygen.
Charlie: It helps plants and gives oxygen to animals.</textarea>

    <button onclick="evaluateAnswers()">‚ú® Evaluate</button>
    <button id="exportBtn" onclick="exportCSV()">üìÑ Export to CSV</button>

    <div class="results" id="results"></div>
  </div>

  <script>
    // Embed your Hugging Face token here for POC (for production use environment variables)
    const HUGGINGFACE_API_TOKEN = "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";
    let resultsCSV = [['Name','Scores','Total','Suggestion']];

    async function evaluateAnswers() {
      const token = HUGGINGFACE_API_TOKEN;
      const model = document.getElementById("model").value;
      const question = document.getElementById("question").value;
      const rubric = document.getElementById("rubric").value.split('\n').filter(Boolean);
      const rawAnswers = document.getElementById("answers").value.split('\n');
      const outputDiv = document.getElementById("results");

      outputDiv.innerHTML = "‚è≥ Evaluating... Please wait...";
      resultsCSV = [['Name','Scores','Total','Suggestion']];
      let results = "";

      for (let line of rawAnswers) {
        if (!line.includes(":")) continue;
        const [name, ...rest] = line.split(":");
        const answer = rest.join(":").trim();

        const rubricList = rubric.map((r, i) => `${i+1}. ${r}`).join("\n");
        const prompt = `You are evaluating a student's answer based on a rubric.\n\nQuestion: ${question}\nRubric:\n${rubricList}\n\nStudent Answer: ${answer}\n\nFor each rubric point, give a score from 0 to 2.\nSum them to get a total out of ${rubric.length * 2}.\nAlso give a brief suggestion.\nRespond in this format:\n\nScores: 1, 2, 0, 2\nTotal: 5/${rubric.length * 2}\nSuggestion: <your suggestion>`;

        const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
          method: "POST",
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ inputs: prompt })
        });

        let json = await response.json();
        let fullText = json[0]?.generated_text || "";
        let resultText = fullText.split("Scores:").pop();
        resultText = "Scores:" + resultText.trim();

        results += `üë§ ${name.trim()}\n${resultText}\n-----------------------------\n`;

        const match = resultText.match(/Scores: (.*)\nTotal: (.*)\nSuggestion: (.*)/);
        if (match) {
          resultsCSV.push([name.trim(), match[1], match[2], match[3]]);
        }
      }

      outputDiv.innerText = results;
    }

    function exportCSV() {
      let csvContent = "data:text/csv;charset=utf-8," +
        resultsCSV.map(e => e.join(",")).join("\n");
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "student_evaluation.csv");
      document.body.appendChild(link);
      link.click();
    }
  </script>
</body>
</html>
